<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>LAB 3</title>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@v0.169.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@v0.169.0/examples/jsm/"
        }
      }
    </script>
  </head>
  <style>
    button {margin-right: 4px; margin-bottom: 8px;}
    div > ol > li {margin: 5px;}
    #container {
      display: grid;
      grid-template-areas: 
      'a b';
    }

    #inner {
      display: grid;
      grid-template-columns: 2;
    }
  </style>
  <body>
    <audio src="/distance.mp3"></audio>
    <div id="container">
    <div class="a" id="dictionary">
    <div id="search">
      <input type="search" id="text-in" name="search">
      <button id="srch-bt" data-playing="false" role="switch" aria-checked="false">Search</button>
    </div>
    <div id="words">
      <div id="yourWordIs"></div>
      <div id="definition"></div>
    </div>
    </div>
    <div class="b" id="inner">
      <div class="c" id="cube">
      </div>
      <div class="d">
        <img src = "https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Merriam-Webster_logo.svg/800px-Merriam-Webster_logo.svg.png" width="200" id="spin">
      </div>
    </div>
    </div>
  </body>
  <script>
    const textInput = document.querySelector("#text-in")
    const searchButton = document.querySelector("#srch-bt")
    const theWord = document.querySelector("#yourWordIs")
    const definitionProper = document.querySelector("#definition")
    const theCube = document.querySelector("#cube") 

    window.onload = function(){
      if(localStorage.length != 0){
        recentWord = localStorage.getItem("store")
        recentDef = localStorage.getItem("def")
        defJSON = JSON.parse(recentDef)
        let refDisplay = defJSON[0].meanings
        displayWord(recentWord)
        displayDefinition(refDisplay)
      }
    }

    function displayWord (thing) {
      theWord.innerHTML = ""
      let disp = document.createElement("h1")
      disp.textContent = thing
      theWord.appendChild(disp)
    }

    function synListener (evt) {
      let targetList = evt.currentTarget.listParam
      const listSyns = document.createElement("li")
      const synsList = evt.currentTarget.synParam
      if (synsList.length != 0) {
            const synsProper = "Synonyms: "
            result = synsProper.concat(synsList.join(", "))
            listSyns.textContent = result
          }
          else {
            listSyns.textContent = "No synonym available"
          }
          targetList.appendChild(listSyns)
    }

    function antListener (evt) {
      let targetList = evt.currentTarget.listParam
      const listAnts = document.createElement("li")
      const antsList = evt.currentTarget.antParam
      if (antsList.length != 0) {
            const antsProper = "Antonyms: "
            result = antsProper.concat(antsList.join(", "))
            listAnts.textContent = result
          }
          else {
            listAnts.textContent = "No antonym available"
          }
          targetList.appendChild(listAnts)
    }

    function buttonCreation (finit, nym, mList, inner){
      if (nym=="syno"){
        const synBtn = document.createElement("button")
        synBtn.textContent = "Show Synonyms"
        synBtn.synParam = finit.synonyms
        synBtn.listParam = inner
        synBtn.addEventListener('click', synListener)
        synBtn.addEventListener('click', () => synBtn.disabled = true)
        mList.appendChild(synBtn)
      }

      else if (nym=="anto"){
        const antBtn = document.createElement("button")
        antBtn.textContent = "Show Antonyms"
        antBtn.antParam = finit.antonyms
        antBtn.listParam = inner
        antBtn.addEventListener('click', antListener)
        antBtn.addEventListener('click', () => antBtn.disabled = true)
        mList.appendChild(antBtn)
      }
    }

    function displayDefinition (defs) {
      definitionProper.innerHTML = ""
      const means = document.createElement("h2")
      means.textContent = "Definitions:"
      definitionProper.appendChild(means)

      for (def of defs) {
        const meanList = document.createElement("ol")

        const pOS = document.createElement("h3")
        pOS.textContent = def.partOfSpeech
        meanList.appendChild(pOS)

        const innerDef = document.createElement("ul")
        buttonCreation(def, "syno", meanList, innerDef)
        buttonCreation(def, "anto", meanList, innerDef)
        meanList.appendChild(innerDef)

        for (mean of def.definitions) {
          const defItem = document.createElement("li")
          deftn = mean.definition
          defItem.textContent = deftn
          definitionProper.appendChild(meanList)
          meanList.appendChild(defItem)
        }
      }
    }

    function searchOnClick(evt){
      word = textInput.value
      if (word != " "){
        localStorage.setItem("store", word)
        var url = "https://api.dictionaryapi.dev/api/v2/entries/en/" + word
        fetch(url).then(res => {
          return res.json()
        }).then(res => {
          localStorage.setItem("def", JSON.stringify(res))
          let toDisplay = res[0].meanings
          console.log(toDisplay)
          displayWord(word)
          displayDefinition(toDisplay)
        }).catch(err => {
          console.log(err)
          alert("Word not found")
        })
      }
      else {
        alert("Word not found")
      }
    }

    function playOnClick(evt){
      if (audioContext.state === "suspended") {
        audioContext.resume();
      }

      if (playButton.dataset.playing === "false") {
        audioElement.play();
        playButton.dataset.playing = "true";
      } else if (playButton.dataset.playing === "true") {
        audioElement.pause();
        playButton.dataset.playing = "false";
      }
    }

    searchButton.addEventListener('click', searchOnClick)
  </script>

  <script type = "module">
    // three.js
    import * as THREE from 'three';
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth/2, window.innerHeight/2 );
    renderer.setClearColor( 0xffffff, 0 );
    theCube.appendChild( renderer.domElement );

    const geometry = new THREE.BoxGeometry( 3.5, 3.5, 3.5 );
    const material = new THREE.MeshBasicMaterial( { color: 0x653ea4 } );
    const cube = new THREE.Mesh( geometry, material );
    scene.add( cube );
    camera.position.z = 5;

    function animate() {
      cube.rotation.x += 0.01;
      cube.rotation.y += 0.01;
      cube.rotation.z += 0.01;
      renderer.render( scene, camera );
    }
    renderer.setAnimationLoop( animate );
  </script>

  <script>
    // audio
    const audioContext = new AudioContext();
    const audioElement = document.querySelector("audio");
    const track = audioContext.createMediaElementSource(audioElement);
    track.connect(audioContext.destination);
    audioElement.addEventListener(
      "ended",
      () => {
        playButton.dataset.playing = "false";
      },
      false,);
  </script>

  <script>
    // play audio when clicking search button
    const playButton = document.querySelector("#srch-bt");
    playButton.addEventListener(
      "click", () => {
        if (audioContext.state === "suspended") {
          audioContext.resume();
        }

        if (playButton.dataset.playing === "false") {
          audioElement.play();
          playButton.dataset.playing = "true";

          setTimeout(() => {
          audioElement.pause()
          playButton.dataset.playing = "false"
          audioElement.currentTime = 0
        }, 5000)
        }
      }
    )
  </script>

  <script>
    const dictTumbling = [
      { transform: "rotate(0)" },
      { transform: "rotate(360deg)" },
    ];

    const dictTiming = {
      duration: 5000,
      iterations: Infinity
    };
    document.getElementById("spin").animate(dictTumbling, dictTiming);
  </script>
</html>

